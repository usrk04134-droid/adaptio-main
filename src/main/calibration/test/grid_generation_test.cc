
#include <doctest/doctest.h>

#include <cstddef>
#include <numbers>

#include "../src/calibration_grid_generator.h"
// #include "src/calibration_solver.h"
#include "../src/calibration_solver_impl.h"
#include "calibration/src/calibration_solver.h"
// #include "calibration/src/calibration_solver.h"
// #include "slice_translator/model_extract.h"

// NOLINTBEGIN(*-magic-numbers, misc-include-cleaner)

namespace calibration {

TEST_SUITE("CalibrationGridGenerator") {
  TEST_CASE("Generated points are inside expected areas") {
    // Origo assumed at bottom tip of joint

    // Test parameters
    const double width       = 60.0;  // joint width
    const double depth       = 50.0;  // joint depth
    const double joint_angle = 0.52;
    const double c           = 50.0;  // distance between touch left and right points

    const calibration::GridConfiguration grid_config = {
        .margin_top = 5.0, .margin_x = 30.0, .margin_z = 30.0, .margin_c = 5.0, .target_nr_gridpoints = 50};

    // Derived values
    // c_left and c_right are the left and right touch points respectively.
    const double c_left_x  = c / 2.0;  // origo is at the bottom tip of the joint
    const double c_right_x = -c / 2.0;
    const double c_left_z  = depth * (c / width);
    const double c_right_z = depth * (c / width);
    const double delta_c   = 0.5 * (width - c) / std::tan(joint_angle);

    const auto dots = GenerateCalibrationDots(grid_config, c_left_x, c_right_x, c_left_z, delta_c);

    // Helper lambda to check if point is inside A or B
    const auto is_inside = [&](double x, double z) {
      const double c_width = c_left_x - c_right_x;
      const double delta_c = 0.5 * (width - c_width) / std::tan(joint_angle);
      const double a_xmin  = c_right_x;
      const double a_xmax  = c_left_x;
      const double a_zmin  = c_right_z;
      const double a_zmax  = c_right_z + delta_c + grid_config.margin_top;
      const double b_xmin  = c_right_x - grid_config.margin_x;
      const double b_xmax  = c_left_x + grid_config.margin_x;
      const double b_zmin  = a_zmax;
      const double b_zmax  = b_zmin + grid_config.margin_z;

      const bool in_a = (x >= a_xmin) && (x <= a_xmax) && (z >= a_zmin) && (z <= a_zmax);
      const bool in_b = (x >= b_xmin) && (x <= b_xmax) && (z >= b_zmin) && (z <= b_zmax);
      return in_a || in_b;
    };

    // Check
    for (const auto& dot : dots) {
      CHECK(is_inside(dot.GetX(), dot.GetZ()));
    }
  }

  TEST_CASE("Generated points follow correct snake pattern") {
    const double width       = 60.0;
    const double depth       = 50.0;
    const double joint_angle = 0.52;
    const double c           = 50.0;

    const calibration::GridConfiguration grid_config = {
        .margin_top = 5.0, .margin_x = 30.0, .margin_z = 30.0, .margin_c = 5.0, .target_nr_gridpoints = 50};

    const double c_left_x  = c / 2.0;
    const double c_right_x = -c / 2.0;
    const double c_left_z  = depth * (c / width);
    const double delta_c   = 0.5 * (width - c) / std::tan(joint_angle);

    const auto dots = GenerateCalibrationDots(grid_config, c_left_x, c_right_x, c_left_z, delta_c);

    REQUIRE(!dots.empty());

    std::map<int, std::vector<const GridPoint*>> rows;
    for (const auto& dot : dots) {
      rows[dot.index_z].push_back(&dot);
    }

    size_t row_number = 0;
    for (const auto& [row_z, points] : rows) {
      bool right_to_left = (row_number % 2 == 0);

      for (size_t i = 1; i < points.size(); ++i) {
        if (right_to_left) {
          REQUIRE(points[i - 1]->GetX() < points[i]->GetX());
        } else {
          REQUIRE(points[i - 1]->GetX() > points[i]->GetX());
        }
      }

      ++row_number;
    }
  }

  TEST_CASE("Fitted model gives correct clock-position") {
    // Observation obs;
    // obs.slide_position = {1, 1};
    // obs.abw_points_lpcs = {{2,2},{3,3}};
    // Observation: {{slide.hori, slide.vert}, {{abw1.x, abw2.y},{abw2.x, abw2.y},...{abw6.x, abw6.y}}}
    std::vector<Observation> observations = {
        {{-30.000, -15.000},
         {{20.000, -186.282},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {20.000, -186.282}}},
        {{-23.333, -15.000},
         {{26.667, -186.282},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {26.667, -186.282}}},
        {{-16.667, -15.000},
         {{33.333, -186.282},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {33.333, -186.282}}},
        {{-10.000, -15.000},
         {{40.000, -186.282},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {40.000, -186.282}}},
        {{-3.333, -15.000},
         {{46.667, -186.282},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {46.667, -186.282}}},
        {{3.333, -15.000},
         {{53.333, -186.282},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {53.333, -186.282}}},
        {{10.000, -15.000},
         {{60.000, -186.282},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {60.000, -186.282}}},
        {{16.667, -15.000},
         {{66.667, -186.282},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {66.667, -186.282}}},
        {{23.333, -15.000},
         {{73.333, -186.282},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {73.333, -186.282}}},
        {{30.000, -15.000},
         {{80.000, -186.282},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {80.000, -186.282}}},
        {{-30.000, -11.667},
         {{20.000, -189.327},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {20.000, -189.327}}},
        {{-23.333, -11.667},
         {{26.667, -189.327},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {26.667, -189.327}}},
        {{-16.667, -11.667},
         {{33.333, -189.327},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {33.333, -189.327}}},
        {{-10.000, -11.667},
         {{40.000, -189.327},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {40.000, -189.327}}},
        {{-3.333, -11.667},
         {{46.667, -189.327},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {46.667, -189.327}}},
        {{3.333, -11.667},
         {{53.333, -189.327},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {53.333, -189.327}}},
        {{10.000, -11.667},
         {{60.000, -189.327},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {60.000, -189.327}}},
        {{16.667, -11.667},
         {{66.667, -189.327},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {66.667, -189.327}}},
        {{23.333, -11.667},
         {{73.333, -189.327},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {73.333, -189.327}}},
        {{30.000, -11.667},
         {{80.000, -189.327},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {80.000, -189.327}}},
        {{-30.000, -8.333},
         {{20.000, -192.374},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {20.000, -192.374}}},
        {{-23.333, -8.333},
         {{26.667, -192.374},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {26.667, -192.374}}},
        {{-16.667, -8.333},
         {{33.333, -192.374},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {33.333, -192.374}}},
        {{-10.000, -8.333},
         {{40.000, -192.374},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {40.000, -192.374}}},
        {{-3.333, -8.333},
         {{46.667, -192.374},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {46.667, -192.374}}},
        {{3.333, -8.333},
         {{53.333, -192.374},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {53.333, -192.374}}},
        {{10.000, -8.333},
         {{60.000, -192.374},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {60.000, -192.374}}},
        {{16.667, -8.333},
         {{66.667, -192.374},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {66.667, -192.374}}},
        {{23.333, -8.333},
         {{73.333, -192.374},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {73.333, -192.374}}},
        {{30.000, -8.333},
         {{80.000, -192.374},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {80.000, -192.374}}},
        {{-30.000, -5.000},
         {{20.000, -195.423},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {20.000, -195.423}}},
        {{-23.333, -5.000},
         {{26.667, -195.423},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {26.667, -195.423}}},
        {{-16.667, -5.000},
         {{33.333, -195.423},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {33.333, -195.423}}},
        {{-10.000, -5.000},
         {{40.000, -195.423},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {40.000, -195.423}}},
        {{-3.333, -5.000},
         {{46.667, -195.423},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {46.667, -195.423}}},
        {{3.333, -5.000},
         {{53.333, -195.423},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {53.333, -195.423}}},
        {{10.000, -5.000},
         {{60.000, -195.423},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {60.000, -195.423}}},
        {{16.667, -5.000},
         {{66.667, -195.423},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {66.667, -195.423}}},
        {{23.333, -5.000},
         {{73.333, -195.423},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {73.333, -195.423}}},
        {{30.000, -5.000},
         {{80.000, -195.423},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {80.000, -195.423}}},
        {{-30.000, -1.667},
         {{20.000, -198.474},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {20.000, -198.474}}},
        {{-23.333, -1.667},
         {{26.667, -198.474},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {26.667, -198.474}}},
        {{-16.667, -1.667},
         {{33.333, -198.474},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {33.333, -198.474}}},
        {{-10.000, -1.667},
         {{40.000, -198.474},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {40.000, -198.474}}},
        {{-3.333, -1.667},
         {{46.667, -198.474},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {46.667, -198.474}}},
        {{3.333, -1.667},
         {{53.333, -198.474},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {53.333, -198.474}}},
        {{10.000, -1.667},
         {{60.000, -198.474},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {60.000, -198.474}}},
        {{16.667, -1.667},
         {{66.667, -198.474},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {66.667, -198.474}}},
        {{23.333, -1.667},
         {{73.333, -198.474},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {73.333, -198.474}}},
        {{30.000, -1.667},
         {{80.000, -198.474},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {80.000, -198.474}}},
        {{-30.000, 1.667},
         {{20.000, -201.527},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {20.000, -201.527}}},
        {{-23.333, 1.667},
         {{26.667, -201.527},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {26.667, -201.527}}},
        {{-16.667, 1.667},
         {{33.333, -201.527},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {33.333, -201.527}}},
        {{-10.000, 1.667},
         {{40.000, -201.527},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {40.000, -201.527}}},
        {{-3.333, 1.667},
         {{46.667, -201.527},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {46.667, -201.527}}},
        {{3.333, 1.667},
         {{53.333, -201.527},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {53.333, -201.527}}},
        {{10.000, 1.667},
         {{60.000, -201.527},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {60.000, -201.527}}},
        {{16.667, 1.667},
         {{66.667, -201.527},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {66.667, -201.527}}},
        {{23.333, 1.667},
         {{73.333, -201.527},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {73.333, -201.527}}},
        {{30.000, 1.667},
         {{80.000, -201.527},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {80.000, -201.527}}},
        {{-30.000, 5.000},
         {{20.000, -204.581},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {20.000, -204.581}}},
        {{-23.333, 5.000},
         {{26.667, -204.581},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {26.667, -204.581}}},
        {{-16.667, 5.000},
         {{33.333, -204.581},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {33.333, -204.581}}},
        {{-10.000, 5.000},
         {{40.000, -204.581},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {40.000, -204.581}}},
        {{-3.333, 5.000},
         {{46.667, -204.581},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {46.667, -204.581}}},
        {{3.333, 5.000},
         {{53.333, -204.581},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {53.333, -204.581}}},
        {{10.000, 5.000},
         {{60.000, -204.581},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {60.000, -204.581}}},
        {{16.667, 5.000},
         {{66.667, -204.581},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {66.667, -204.581}}},
        {{23.333, 5.000},
         {{73.333, -204.581},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {73.333, -204.581}}},
        {{30.000, 5.000},
         {{80.000, -204.581},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {80.000, -204.581}}},
        {{-30.000, 8.333},
         {{20.000, -207.637},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {20.000, -207.637}}},
        {{-23.333, 8.333},
         {{26.667, -207.637},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {26.667, -207.637}}},
        {{-16.667, 8.333},
         {{33.333, -207.637},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {33.333, -207.637}}},
        {{-10.000, 8.333},
         {{40.000, -207.637},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {40.000, -207.637}}},
        {{-3.333, 8.333},
         {{46.667, -207.637},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {46.667, -207.637}}},
        {{3.333, 8.333},
         {{53.333, -207.637},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {53.333, -207.637}}},
        {{10.000, 8.333},
         {{60.000, -207.637},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {60.000, -207.637}}},
        {{16.667, 8.333},
         {{66.667, -207.637},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {66.667, -207.637}}},
        {{23.333, 8.333},
         {{73.333, -207.637},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {73.333, -207.637}}},
        {{30.000, 8.333},
         {{80.000, -207.637},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {80.000, -207.637}}},
        {{-30.000, 11.667},
         {{20.000, -210.696},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {20.000, -210.696}}},
        {{-23.333, 11.667},
         {{26.667, -210.696},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {26.667, -210.696}}},
        {{-16.667, 11.667},
         {{33.333, -210.696},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {33.333, -210.696}}},
        {{-10.000, 11.667},
         {{40.000, -210.696},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {40.000, -210.696}}},
        {{-3.333, 11.667},
         {{46.667, -210.696},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {46.667, -210.696}}},
        {{3.333, 11.667},
         {{53.333, -210.696},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {53.333, -210.696}}},
        {{10.000, 11.667},
         {{60.000, -210.696},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {60.000, -210.696}}},
        {{16.667, 11.667},
         {{66.667, -210.696},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {66.667, -210.696}}},
        {{23.333, 11.667},
         {{73.333, -210.696},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {73.333, -210.696}}},
        {{30.000, 11.667},
         {{80.000, -210.696},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {80.000, -210.696}}},
        {{-30.000, 15.000},
         {{20.000, -213.756},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {20.000, -213.756}}},
        {{-23.333, 15.000},
         {{26.667, -213.756},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {26.667, -213.756}}},
        {{-16.667, 15.000},
         {{33.333, -213.756},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {33.333, -213.756}}},
        {{-10.000, 15.000},
         {{40.000, -213.756},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {40.000, -213.756}}},
        {{-3.333, 15.000},
         {{46.667, -213.756},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {46.667, -213.756}}},
        {{3.333, 15.000},
         {{53.333, -213.756},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {53.333, -213.756}}},
        {{10.000, 15.000},
         {{60.000, -213.756},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {60.000, -213.756}}},
        {{16.667, 15.000},
         {{66.667, -213.756},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {66.667, -213.756}}},
        {{23.333, 15.000},
         {{73.333, -213.756},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {73.333, -213.756}}},
        {{30.000, 15.000},
         {{80.000, -213.756},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {0.000, 0.000},
          {80.000, -213.756}}}
    };
    // Observation center_bottom{{33.333, 0.000}, {{23.333, -100.000}, {0.000, 0.000}, {0.000, 0.000}, {0.000, 0.000},
    // {0.000, 0.000}, {0.000, 0.000}, {73.333, -100.000}}};
    Observation center_top{
        {33.333, 30.000},
        {{23.333, -128.087},
         {0.000, 0.000},
         {0.000, 0.000},
         {0.000, 0.000},
         {0.000, 0.000},
         {0.000, 0.000},
         {73.333, -128.087}}
    };

    const double scanner_mount_angle       = 20.0 * std::numbers::pi / 180.0;
    const double object_radius             = 1360.0 / 2;  // mm
    const double groove_center             = 0.0;
    const double groove_top                = 0.0;
    const double stickout                  = 35.0;
    const double torch_to_laser_plane_dist = 120.0;
    slice_translator::ModelImpl model{};
    calibration::CalibrationSolverImpl solver(&model);
    const TorchPlaneInfo tpi{
        .top_center_at_torch_plane = {.horizontal = groove_center, .vertical = groove_top}
    };

    const GeometricConstants geometric_constants{.object_radius            = object_radius,
                                                 .scanner_mount_angle      = scanner_mount_angle,
                                                 .ltc_stickout             = stickout,
                                                 .ltc_laser_plane_distance = torch_to_laser_plane_dist};

    solver.Calculate(tpi, geometric_constants, observations);
  }
}
}  // namespace calibration

// NOLINTEND(*-magic-numbers, misc-include-cleaner)
